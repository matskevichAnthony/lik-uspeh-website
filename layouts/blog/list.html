{{ define "main" }}
<div class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
  <!-- Hero секция -->
  <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
    <div class="container mx-auto px-4 py-16">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl font-bold mb-6">{{ .Title }}</h1>
        <p class="text-xl text-blue-100 leading-relaxed">
          Последние новости, события и достижения гимназии «ЛИК-Успех»
        </p>
      </div>
    </div>
  </div>

  <div class="container mx-auto px-4 py-8">
    <!-- Поиск и фильтры -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8">
      <div class="flex flex-col lg:flex-row gap-6">
        <!-- Поиск Pagefind -->
        <div class="flex-1">
          <div class="relative">
            <div id="search" class="pagefind-ui" data-pagefind-ui></div>
          </div>
        </div>
        
        <!-- Фильтры -->
        <div class="flex flex-wrap gap-4 lg:w-auto">
          <!-- Фильтр по типу контента -->
          <div class="relative">
            <select id="content-type-filter" class="appearance-none bg-gray-50 border border-gray-300 rounded-lg px-4 py-2 pr-8 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="">Все типы</option>
              {{ range $key, $type := $.Site.Data.content_types.content_types }}
              <option value="{{ $type.slug }}">{{ $type.name }}</option>
              {{ end }}
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </div>
          </div>

          <!-- Фильтр по аудитории -->
          <div class="relative">
            <select id="audience-filter" class="appearance-none bg-gray-50 border border-gray-300 rounded-lg px-4 py-2 pr-8 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="">Все аудитории</option>
              {{ range $key, $audience := $.Site.Data.audiences.audiences }}
              <option value="{{ $audience.slug }}">{{ $audience.name }}</option>
              {{ end }}
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </div>
          </div>

          <!-- Фильтр по категории -->
          <div class="relative">
            <select id="category-filter" class="appearance-none bg-gray-50 border border-gray-300 rounded-lg px-4 py-2 pr-8 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="">Все категории</option>
              {{ range $key, $category := $.Site.Data.categories.categories }}
              <option value="{{ $category.slug }}">{{ $category.name }}</option>
              {{ end }}
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </div>
          </div>

          <!-- Кнопка сброса фильтров -->
          <button id="clear-filters" class="px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
            Сбросить
          </button>
        </div>
      </div>
    </div>

    <!-- Счетчик результатов -->
    <div id="results-counter" class="mb-6 text-gray-600 text-sm">
      Найдено статей: <span id="total-count">{{ len .Paginator.Pages }}</span>
    </div>

    <!-- Список статей -->
    <div id="blog-posts" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {{ range .Paginator.Pages }}
      <article class="blog-post-card bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1"
               data-content-type="{{ .Params.content_type | default "news" }}"
               {{ with .Params.audience }}data-audience="{{ . }}"{{ end }}
               {{ with .Params.category }}data-category="{{ . }}"{{ end }}
               data-pagefind-body>
        <!-- Изображение -->
        {{ if .Params.image }}
        <div class="aspect-video bg-gradient-to-br from-blue-500 to-indigo-600 relative overflow-hidden">
          <img src="{{ .Params.image | relURL }}" alt="{{ .Title }}" class="w-full h-full object-cover">
          <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
        </div>
        {{ else }}
        <div class="aspect-video bg-gradient-to-br from-blue-500 to-indigo-600 relative flex items-center justify-center">
          <svg class="w-12 h-12 text-white/80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2.5 2.5 0 00-2.5-2.5H16"/>
          </svg>
        </div>
        {{ end }}

        <div class="p-6">
          <!-- Метаданные и badges -->
          <div class="flex flex-wrap items-center gap-2 mb-4">
            <!-- Content Type Badge -->
            {{ $contentType := index $.Site.Data.content_types.content_types (.Params.content_type | default "news") }}
            {{ if $contentType }}
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-{{ $contentType.color }}-100 text-{{ $contentType.color }}-800">
              <i class="{{ $contentType.icon }} w-3 h-3 mr-1"></i>
              {{ $contentType.name }}
            </span>
            {{ end }}

            <!-- Audience Badge -->
            {{ $audience := index $.Site.Data.audiences.audiences (.Params.audience | default "general") }}
            {{ if $audience }}
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-{{ $audience.color }}-100 text-{{ $audience.color }}-800">
              <i class="{{ $audience.icon }} w-3 h-3 mr-1"></i>
              {{ $audience.name }}
            </span>
            {{ end }}

            <!-- Дата -->
            <time datetime="{{ .Date.Format "2006-01-02" }}" class="text-xs text-gray-500">
              {{ .Date.Format "2 января 2006" }}
            </time>
          </div>

          <!-- Заголовок -->
          <h2 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2 hover:text-blue-600 transition-colors">
            <a href="{{ .RelPermalink }}" class="block">{{ .Title }}</a>
          </h2>

          <!-- Описание -->
          {{ if .Summary }}
          <p class="text-gray-600 mb-4 text-sm leading-relaxed line-clamp-3">{{ .Summary }}</p>
          {{ end }}

          <!-- Теги -->
          {{ if .Params.tags }}
          <div class="flex flex-wrap gap-1 mb-4">
            {{ range first 3 .Params.tags }}
            <span class="inline-block px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-md">#{{ . }}</span>
            {{ end }}
          </div>
          {{ end }}

          <!-- Кнопка читать далее -->
          <div class="flex items-center justify-between">
            <a href="{{ .RelPermalink }}" class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors group">
              Читать далее
              <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </a>
            
            <!-- Время чтения -->
            {{ if .ReadingTime }}
            <span class="text-xs text-gray-500">{{ .ReadingTime }} мин</span>
            {{ end }}
          </div>
        </div>
      </article>
      {{ end }}
    </div>

    <!-- Пагинация -->
    {{ if gt .Paginator.TotalPages 1 }}
    <nav class="mt-12 flex justify-center">
      <div class="flex items-center space-x-2">
        {{ if .Paginator.HasPrev }}
        <a href="{{ .Paginator.Prev.URL }}" class="inline-flex items-center px-4 py-2 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Предыдущая
        </a>
        {{ end }}
        
        {{ range .Paginator.Pagers }}
        {{ if eq . $.Paginator }}
        <span class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg">{{ .PageNumber }}</span>
        {{ else }}
        <a href="{{ .URL }}" class="px-4 py-2 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">{{ .PageNumber }}</a>
        {{ end }}
        {{ end }}
        
        {{ if .Paginator.HasNext }}
        <a href="{{ .Paginator.Next.URL }}" class="inline-flex items-center px-4 py-2 bg-white border border-gray-300 text-sm font-medium text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
          Следующая
          <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
        {{ end }}
      </div>
    </nav>
    {{ end }}
  </div>
</div>

<!-- Pagefind и фильтрация JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Инициализация фильтров
  const contentTypeFilter = document.getElementById('content-type-filter');
  const audienceFilter = document.getElementById('audience-filter');
  const categoryFilter = document.getElementById('category-filter');
  const clearFiltersBtn = document.getElementById('clear-filters');
  const blogPosts = document.querySelectorAll('.blog-post-card');
  const totalCountSpan = document.getElementById('total-count');
  
  // Функция фильтрации
  function filterPosts() {
    const contentType = contentTypeFilter.value;
    const audience = audienceFilter.value;
    const category = categoryFilter.value;
    
    let visibleCount = 0;
    
    blogPosts.forEach(post => {
      const postContentType = post.dataset.contentType;
      const postAudience = post.dataset.audience || '';
      const postCategory = post.dataset.category || '';
      
      const matchesContentType = !contentType || postContentType === contentType;
      const matchesAudience = !audience || postAudience === audience;
      const matchesCategory = !category || postCategory === category;
      
      if (matchesContentType && matchesAudience && matchesCategory) {
        post.style.display = 'block';
        visibleCount++;
      } else {
        post.style.display = 'none';
      }
    });
    
    totalCountSpan.textContent = visibleCount;
  }
  
  // Обработчики событий для фильтров
  contentTypeFilter.addEventListener('change', filterPosts);
  audienceFilter.addEventListener('change', filterPosts);
  categoryFilter.addEventListener('change', filterPosts);
  
  // Сброс фильтров
  clearFiltersBtn.addEventListener('click', function() {
    contentTypeFilter.value = '';
    audienceFilter.value = '';
    categoryFilter.value = '';
    filterPosts();
  });
});
</script>

<!-- Подключение Pagefind -->
<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    new PagefindUI({ 
      element: "#search",
      showSubResults: true,
      showImages: false,
      excerptLength: 15,
      translations: {
        placeholder: "Поиск по блогу...",
        clear_search: "Очистить",
        load_more: "Загрузить ещё",
        search_label: "Поиск по сайту",
        filters_label: "Фильтры",
        zero_results: "Ничего не найдено для [SEARCH_TERM]",
        many_results: "[COUNT] результатов для [SEARCH_TERM]",
        one_result: "[COUNT] результат для [SEARCH_TERM]",
        alt_search: "Ничего не найдено для [SEARCH_TERM]. Показаны результаты для [DIFFERENT_TERM]",
        search_suggestion: "Попробуйте поискать [DIFFERENT_TERM]",
        searching: "Поиск [SEARCH_TERM]..."
      }
    });
  });
</script>
{{ end }}